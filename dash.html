<html>
<head class="head">
<link href='//fonts.googleapis.com/css?family=Roboto' rel='stylesheet' type='text/css'>
<style>
body {
    font-family: 'Roboto', sans-serif;
}
.container {
    display: flex;
    width: 100%;
    background-color: #d1c4e9;
    flex-wrap: wrap;
    align-content: flex-start;
}
.box {
    width: 300px;
    height: 250px;
    min-width: 50px;
    min-height: 70px;
    border: 2px solid #3f51b5;
    border-radius: 5px;
    margin: 10px;
    overflow: scroll;
    text-align: center;
    color: white;
    background-color: #311b92;
    resize: both;
}
.box:hover {
    border-color: #b388ff;
}
.image {
    transition: all 100ms ease-in-out;
}
.butt {
    cursor: pointer;
    font-size: 80%;
    color: #00bcd4;
}
.query {
    width: 70%;
}
.name {
    width: 20%;
}
.store {
    font-size: 20%;
    width: 100%;
    overflow: hidden;
}
</style>
<script>
function bookmarks_load_callback(l) {
    var key = location.protocol + '//' + location.hostname + location.pathname;
    var storage = JSON.parse(localStorage.getItem(key)) || {};
    for(var k in l) {
        storage[k] = l[k];
    }
    localStorage.setItem(key, JSON.stringify(storage));
    document.location = key;
}
function load_bookmarks() {
    var source = window.location.search.substring(1);
    try {
        var l = JSON.parse(decodeURI(source));
        var storage = JSON.parse(localStorage.getItem(key)) || {};
        for(k in l) {
            storage[k] = l[k];
        }
        localStorage.setItem(key, JSON.stringify(storage));
        document.location = key;
    } catch(e) {
        var sc = document.createElement("script");
        sc.setAttribute("src", source)
        document.getElementsByClassName("head")[0].appendChild(sc);
    }
}
function add_new() {
    var name = document.getElementById('name').value;
    var query = document.getElementById('query').value;
    storage[name] = query;
    localStorage.setItem(key, JSON.stringify(storage));
    draw_boxes();
}
function edit(name, url) {
    document.getElementById('name').value = name;
    document.getElementById('query').value = url;
}
function drop(name) {
    delete storage[name];
    localStorage.setItem(key, JSON.stringify(storage));
    draw_boxes();
}
function draw_boxes() {
    load_bookmarks();
    var html = "";
    this.storage = JSON.parse(localStorage.getItem(key)) || {};
    for(name in storage) {
        var url = storage[name];
        html += "<div class='box'>" + name;
        html += "<span class='butt' onclick='edit(\"" + name+ "\", \"" + url + "\")'>(edit)</span>";
        html += "<span class='butt' onclick='drop(\"" + name+ "\")'>(del)</span>";
        html += "<br><a href='" + url + "' target='_blank'><img class='image' src='" + url + "'></a></div>";
    }
    var container = document.getElementById('container');
    container.innerHTML = html;
    var s = document.getElementById('store');
    s.innerHTML = localStorage.getItem(key);
}
function update_images() {
    var images = document.getElementsByClassName('image');
    for(var i=0; i < images.length; i++){
        if(images[i].src.indexOf('?') == -1) {
            images[i].src = images[i].src + '?s';
        } else {
            images[i].src = images[i].src + '&s';
        }
    }
}
function init() {
    this.key = location.protocol + '//' + location.hostname + location.pathname;
    draw_boxes();
    setInterval(update_images, 120000);
}
</script>
</head>
<body onload="init()">
<div>
  <input type='text' placeholder='Header' class='name' id='name'>
  <input type='text' placeholder='Chart URL' class='query' id='query'>
  <button onclick="add_new()">CREATE CHART</button>
</div>
<div class='container' id='container'></div>
<div class='store' id='store'></div>
</body>
</html>
